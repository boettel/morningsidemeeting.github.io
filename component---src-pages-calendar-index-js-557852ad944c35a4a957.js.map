{"version":3,"sources":["webpack:///./src/pages/calendar/index.js","webpack:///./src/components/calendar/calendar.module.scss","webpack:///./src/components/calendar/index.js"],"names":["allCalendarIds","Object","values","CALENDAR_IDS","CalendarPage","withSubtitle","calendarIds","module","exports","fetchCalendar","calendarId","maxResults","a","console","log","Promise","resolve","reject","loadAndInitGapi","then","client","calendar","events","list","timeMin","Date","toISOString","showDeleted","singleEvents","orderBy","response","result","items","catch","error","Calendar","main","withFooter","useState","setEvents","hasFetchedEvents","setHasFetchedEvents","loadedEvents","all","map","calendarEvents","concat","groupedEvents","groupEvents","eventsMap","Map","sort","evtA","evtB","startA","getEventDate","start","startB","reduce","acc","evt","i","startMonth","format","parseEventISODate","monthEvents","get","set","dateTime","date","parseISO","displayDay","displayTime","renderEvent","summary","id","location","description","end","organizer","email","startDate","endDate","startDayStr","displaySpan","key","dangerouslySetInnerHTML","__html","displayName","useEffect","fetchCalendarEvents","Fragment","size","months","eventsByMonth","entries","next","value","month","evts","push","className","Styles","calendarMonth","renderEvents"],"mappings":"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","file":"component---src-pages-calendar-index-js-557852ad944c35a4a957.js","sourcesContent":["import React from \"react\";\nimport CoreLayout from \"../../components/coreLayout\";\nimport Calendar from \"../../components/calendar\";\nimport { CALENDAR_IDS } from \"../../shared/googleConfig\";\n\nconst allCalendarIds = Object.values(CALENDAR_IDS);\n\nconst CalendarPage = () => {\n  return (\n    <CoreLayout withSubtitle={false}>\n      <Calendar calendarIds={allCalendarIds} />\n    </CoreLayout>\n  );\n};\nexport default CalendarPage;\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"calendarMonth\":\"calendar-module--calendarMonth--kE_ir\",\"calendarEvents\":\"calendar-module--calendarEvents--FPY5u\"};","import React, { useState, useEffect, Fragment } from \"react\";\nimport { format } from \"date-fns\";\nimport { parseISO } from \"date-fns/esm\";\nimport Styles from \"./calendar.module.scss\";\nimport Gapi, { loadAndInitGapi } from \"../gapi\";\nimport { CALENDAR_IDS } from \"../../shared/googleConfig\";\n\nasync function fetchCalendar(calendarId, maxResults = 10) {\n  // also accept calendar slugs\n  if (CALENDAR_IDS[calendarId]) {\n    calendarId = CALENDAR_IDS[calendarId];\n  }\n  console.log(\"fetch this calendar ID\", calendarId);\n  return new Promise(async (resolve, reject) => {\n    try {\n      loadAndInitGapi()\n        .then((client) => {\n          client.calendar.events\n            .list({\n              calendarId,\n              timeMin: new Date().toISOString(),\n              showDeleted: false,\n              singleEvents: true,\n              orderBy: \"startTime\",\n              maxResults,\n            })\n            .then(function (response) {\n              resolve(response.result.items);\n            })\n            .catch((error) => {\n              resolve([]);\n            });\n        })\n        .catch((error) => {\n          console.log(\"Calendar was unable to load\", error);\n          resolve([]);\n        });\n    } catch (error) {\n      console.log(error);\n      resolve([]);\n    }\n  });\n}\n\nconst Calendar = ({ calendarIds = [CALENDAR_IDS.main], withFooter = true }) => {\n  const [events, setEvents] = useState([]);\n  const [hasFetchedEvents, setHasFetchedEvents] = useState(false);\n\n  async function fetchCalendarEvents() {\n    if (hasFetchedEvents) {\n      return;\n    }\n    let loadedEvents = [];\n    await Promise.all(\n      calendarIds.map(async (calendarId) => {\n        const calendarEvents = await fetchCalendar(calendarId);\n        loadedEvents = loadedEvents.concat(...calendarEvents);\n      })\n    );\n\n    setHasFetchedEvents(true);\n    const groupedEvents = groupEvents(loadedEvents);\n    setEvents(groupedEvents);\n  }\n\n  function groupEvents(events) {\n    const eventsMap = new Map();\n    return events\n      .sort((evtA, evtB) => {\n        const startA = getEventDate(evtA.start);\n        const startB = getEventDate(evtB.start);\n\n        if (startA > startB) {\n          return 1;\n        } else if (startB > startA) {\n          return -1;\n        } else {\n          return 0;\n        }\n      })\n      .reduce((acc, evt, i) => {\n        const startMonth = format(parseEventISODate(evt.start), \"MMMM\");\n        const monthEvents = acc.get(startMonth);\n        if (!monthEvents) {\n          acc.set(startMonth, [evt]);\n        } else {\n          acc.set(startMonth, monthEvents.concat(evt));\n        }\n        return acc;\n      }, eventsMap);\n  }\n\n  function getEventDate(evt) {\n    return evt.dateTime || evt.date;\n  }\n\n  function parseEventISODate(evt) {\n    return parseISO(getEventDate(evt));\n  }\n\n  function displayDay(date) {\n    return format(date, \"MMMM d, y\");\n  }\n\n  function displayTime(date) {\n    return format(date, \"h:mm aaaa\");\n  }\n\n  function renderEvent({\n    summary,\n    id,\n    location,\n    description,\n    start,\n    end,\n    organizer,\n  }) {\n    const { email: calendarId } = organizer;\n    const startDate = parseEventISODate(start);\n    const endDate = parseEventISODate(end);\n    const startDayStr = format(startDate, \"yyyy-MM-dd\");\n    const isSameDay = startDayStr === format(endDate, \"yyyy-MM-dd\");\n    const displaySpan = isSameDay\n      ? `${displayDay(startDate)}, ${displayTime(startDate)} to ${displayTime(\n          endDate\n        )}`\n      : `${displayDay(startDate)}, ${displayTime(startDate)} to ${displayDay(\n          endDate\n        )}, ${displayTime(endDate)}`;\n    return (\n      <li key={id}>\n        <header>{summary}</header>\n        <time dateTime={startDayStr}>{displaySpan}</time>\n        {location ? <span>{location}</span> : null}\n        {description ? (\n          <p dangerouslySetInnerHTML={{ __html: description }}></p>\n        ) : null}\n        {withFooter && calendarId !== CALENDAR_IDS.main ? (\n          <footer>{organizer.displayName}</footer>\n        ) : null}\n      </li>\n    );\n  }\n\n  function renderEvents() {\n    if (hasFetchedEvents) {\n      if (!events.size) {\n        return <p>There are no upcoming events on the calendar.</p>;\n      } else {\n        const months = [];\n        const eventsByMonth = events.entries();\n        for (let i = 0; i < events.size; i++) {\n          const [month, evts] = eventsByMonth.next().value;\n          months.push(\n            <Fragment key={`month-${month}`}>\n              <h3 className={Styles.calendarMonth}>{month}</h3>\n              <ul className={Styles.calendarEvents}>{evts.map(renderEvent)}</ul>\n            </Fragment>\n          );\n        }\n        return months;\n      }\n    } else {\n      return <p>Loading events from calendar...</p>;\n    }\n  }\n\n  useEffect(() => {\n    fetchCalendarEvents();\n  });\n\n  return (\n    <React.Fragment>\n      <Gapi />\n      <section>{renderEvents()}</section>\n    </React.Fragment>\n  );\n};\nexport default Calendar;\n"],"sourceRoot":""}